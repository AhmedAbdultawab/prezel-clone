<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src = "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
<script type="text/javascript" src="https://rawgit.com/gitbrent/PptxGenJS/master/dist/pptxgen.js"></script>

<p id="presentationObject"></p>
<button id="save" onclick="downloadPPT()">Make powerpoint</button>
<!-- {"presentation":
    {"title":"dogs",
    "presType":"information",
    "slides":
        [
            {"slideID":"1",
            "slide_type":"comparison",
            "topic_title":"breeds",
            "subtopics":
            [
                {"name":"yorkie","text_content":"small"},
                {"name":"gr","text_content":"big"}
            ]
            }
        ]
    }
}
 -->

<script>
var retrievedObject = localStorage.getItem('formData');
var presentationObject = JSON.parse(retrievedObject);
document.getElementById("presentationObject").innerHTML = retrievedObject;
function isRemoveSlide(slideID) {
    console.log("in function is remove slide");
    //console.log(slideID);
    //console.log(presentationObject);
    var store = presentationObject["presentation"]['ignoreSlides'];
    //console.log(store);
    localStorage["store"] = store;
    if (localStorage.getItem("store") != "undefined") {
        console.log("in if statement");
        var removeSlides = presentationObject["presentation"]['ignoreSlides'];
        //console.log(removeSlides);
        //console.log("use the value above!!");
        for (var s = 0; s < removeSlides.length; s++) {
            if (removeSlides[s]==(slideID)) {
                return true;
            }
        }
    }
    return false;
}

function downloadPPT() {
    var pptx = new PptxGenJS();
    var presTitle = presentationObject.presentation.title;
    var presTitle = presentationObject.presentation.authors;
    var titleSlide = new TitleSlide(pptx, presTitle, authors, 1)
    for (i=0; i < presentationObject.presentation.slides.length; i++) {
        //console.log(presentationObject.presentation.slides[i].slideID);
        var slideObject = presentationObject.presentation.slides[i];
        if (isRemoveSlide(slideObject["slideID"])) {
            continue;
        }
        else {
          //comparison slide
          if (slideObject["slide_type"] == "comparison") {
            var title = slideObject.topic_title;
            var topic1 = slideObject["subtopics"][0];
            var topic2 = slideObject["subtopics"][1];
            var slide= new ComparisonSlide(pptx, title, topic1, topic2, 1)
        }

         else if (slideObject["slide_type"] == "general") {
           var title = slideObject.topic_title;
           var topics = slideObject["subtopics"];
           var slide= new GeneralSlide(pptx,title, topics, 1)
        }

        else if (slideObject["slide_type"] == "agenda") {
            //if (!isRemoveSlide(slideObject["slideID"])) {
            var title = slideObject.topic_title;
            var list = slideObject.text_content[0].split(",").slice(0,5);
            var slide= new AgendaSlide(pptx, title, list, 1)
       }
            //statistics slide
         else if (slideObject["slide_type"] == "statistics") {
           var title = slideObject.topic_title;
           var topics = slideObject["subtopics"];
           var slide= new StatsSlide(pptx, title, topics, 1)
      }
    }
    }
    pptx.save();
}
</script>
